<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Account</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
    #class{
        background-image:url(backgroundimg.jpg);
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center center;
            background-attachment: fixed;
            background-color: #ffffff;
    } body { font-family: 'Inter', sans-serif; } #messageBox { display: none; } </style>
</head>
<body id="class" class="bg-gray-900 text-gray-100 flex items-center justify-center min-h-screen font-sans">
    <div class="w-full max-w-md p-8 space-y-6 bg-gray-800 rounded-lg shadow-xl">
        <h2 class="text-3xl font-bold text-center text-white">Create a New Account</h2>
        <form id="create-account-form" class="space-y-6">
            <div>
                <label for="email" class="block text-sm font-medium text-gray-300">Email</label>
                <input id="email" name="email" type="email" autocomplete="email" required class="w-full px-3 py-2 mt-1 text-gray-100 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
            </div>
            <div>
                <label for="password" class="block text-sm font-medium text-gray-300">Password</label>
                <input id="password" name="password" type="password" autocomplete="new-password" required class="w-full px-3 py-2 mt-1 text-gray-100 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="At least 6 characters">
            </div>
            <div>
                <label for="confirm-password" class="block text-sm font-medium text-gray-300">Confirm Password</label>
                <input id="confirm-password" name="confirm-password" type="password" autocomplete="new-password" required class="w-full px-3 py-2 mt-1 text-gray-100 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
            </div>
            <div id="messageBox" class="p-4 text-sm rounded-md"></div>
            <div>
                <!-- This button is now fixed and is type="submit" -->
                <button type="submit" class="w-full flex justify-center py-3 px-4 text-sm font-semibold rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 focus:ring-offset-gray-900 transition-colors duration-300">
                    Create Account
                </button>
            </div>
        </form>
        <div class="text-sm text-center">
            <a href="login1.html" class="font-medium text-indigo-400 hover:text-indigo-300">
                Already have an account? Login
            </a>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Firebase Configuration ---
        //
        //  YOU MUST REPLACE THIS with your own free config from Firebase.
        //  The code will NOT work with this placeholder.
        //
        const firebaseConfig = {
  apiKey: "AIzaSyBqf4xrDm8xndl9Fa-StCVM161i_wBrx7s",
  authDomain: "my-app-fcb3f.firebaseapp.com",
  projectId: "my-app-fcb3f",
  storageBucket: "my-app-fcb3f.firebasestorage.app",
  messagingSenderId: "135783055383",
  appId: "1:135783055383:web:5dba7c51d46332b7155c52"
};
        //
        //  Go to console.firebase.google.com to get your real config.
        //

        let auth, db, userId, appId;

        const messageBox = document.getElementById('messageBox');
        function showMessage(message, isError = false) {
            messageBox.textContent = message;
            messageBox.className = `p-4 text-sm rounded-md ${isError ? 'bg-red-900 text-red-200' : 'bg-green-900 text-green-200'}`;
            messageBox.style.display = 'block';
        }
        function hideMessage() { messageBox.style.display = 'none'; }

        async function initializeFirebase() {
            try {
                if (!firebaseConfig.apiKey || firebaseConfig.apiKey.includes("AIza...")) {
                     showMessage("Firebase config is missing or is just a placeholder. You must paste your REAL config from the Firebase Console to make this work.", true);
                     return; // Stop here if config is missing
                }
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                appId = firebaseConfig.projectId; 
                setLogLevel('debug');
                await signInAnonymously(auth); 
                console.log("Firebase initialized and signed in anonymously.");
                onAuthStateChanged(auth, (user) => {
                    if (user) userId = user.uid;
                });
            } catch (error) {
                console.error("Firebase Initialization Error:", error);
                showMessage("Failed to initialize application: " + error.message, true);
            }
        }

        const createAccountForm = document.getElementById('create-account-form');
        createAccountForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            hideMessage();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirm-password').value;

            if (password !== confirmPassword) {
                showMessage("Passwords do not match.", true);
                return;
            }
            if (password.length < 6) {
                showMessage("Password must be at least 6 characters.", true);
                return;
            }
            if (!auth || !db) {
                 // This error appears if initializeFirebase() failed
                //showMessage("Authentication service is not ready. Did you paste your firebaseConfig?", true);
                 return;
            }

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                console.log("Successfully created user:", user.uid);
                window.location.href = 'front1.html';
                const userDocRef = doc(db, `artifacts /${appId}/users/${user.uid}/profile`, "data");
                await setDoc(userDocRef, {
                    email: user.email,
                    createdAt: new Date().toISOString(),
                    displayName: user.email.split('@')[0]
                });
                console.log("User profile created in Firestore.");
                showMessage("Account created successfully! Redirecting to app...", false); 
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 2000);
            } catch (error) {
                console.error("Create Account Error:", error);
                if (error.code === 'auth/email-already-in-use') {
                    showMessage("This email is already in use. Please try another.", true);
                } else if (error.code === 'auth/weak-password') {
                    showMessage("Password is too weak. Please choose a stronger password.", true);
                } else if (error.code === 'auth/operation-not-allowed') {
                    showMessage("Error: Email/Password sign-in is not enabled in your Firebase project.", true);
                } else {
                    showMessage(`Error: ${error.message}`, true);
                }
            }
        });

        initializeFirebase();
    </script>
</body>
</html>

